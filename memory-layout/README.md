# 结构体内存对齐

不同的数据类型，会更具其类型大小具有特定的对齐要求，对于结构体而言为了满足对齐要求，可能会在结构体中间插入额外的空间进行填充 `padding`
内存对齐是为了适应 `CPU` 对结构体数据进行快速访问

如果采用紧凑内存布局 `T1` 中的 `b` 需要三个 `CPU` 访问才能读完， `T2` 中只需要两次，所以内存对齐可以提高 `CPU` 访问速度

结构体最终分配的内存大小是所有字段中最大对齐系数的整数倍

# `CPU` 访问

计算机 `CPU` 一次处理数据的位数通常为 `32` 或者 `64` 字长
读取数据时是按照字长的倍数来读取的

# 对齐规则

- 任意类型
  - `unsafe.Alignof` 至少为 1
- 结构体类型
  - `unsafe.Alignof` 为所有字段中的最大值，至少为 1
- 数组
  - 数组元素类型相同

### `unsafe`

- `Sizeof`
  - 计算类型示例长度
- `Offsetof`
  - 计算结构体字段偏移量
  - 传入非结构体，编译可以通过，运行时报错
- `Alignof`
  - 类型示例对齐系数